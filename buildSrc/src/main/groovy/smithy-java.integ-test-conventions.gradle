sourceSets {
    create("it") {
        compileClasspath += sourceSets.main.output + configurations["testRuntimeClasspath"] + configurations["testCompileClasspath"]
        runtimeClasspath += output + compileClasspath + sourceSets.test.runtimeClasspath + sourceSets.test.output
    }
}

// Add the integ test task
tasks.register("integ", Test) {
    useJUnitPlatform()
    testClassesDirs = sourceSets.it.output.classesDirs
    classpath = sourceSets.it.runtimeClasspath
}

// Always run integ tests after base tests
// tasks["test"].finalizedBy("integ")
